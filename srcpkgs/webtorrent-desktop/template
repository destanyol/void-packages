# Template file for 'webtorrent-desktop'
pkgname=webtorrent-desktop
version=0.20.0
revision=1
archs="x86_64"
hostmakedepends="git nodejs zip"
short_desc="Streaming torrent application, desktop version"
maintainer="destanyol <dani.estanyol@gmail.com>"
license="MIT"
homepage="https://webtorrent.io/desktop"
distfiles="https://github.com/webtorrent/webtorrent-desktop/archive/v${version}.tar.gz"
checksum=2eec644337f2e8a47187c54d702491e3b4c1f1236dae48cb494c4e99ba0a9796
nopie=yes
tags="torrent streaming"

case "${XBPS_TARGET_MACHINE}" in
	x86_64*) _target="x64";;
	*) broken="This architecture is not currently supported by WebTorrent Desktop builds";;
esac

do_configure() {
	sed -i 's/"buble": "^0.19.3"/"buble": "0.19.3"/g' package.json
	sed -i 's/"parse-torrent": "^5.7.3"/"parse-torrent": "5.7.3"/g' package.json
}

do_build() {
	npm install
	npm run package -- linux --package=zip
}

do_install() {
	vmkdir /opt/webtorrent-desktop
	vcopy dist/WebTorrent-linux-${_target}/* /opt/webtorrent-desktop
	vmkdir /usr/bin
	ln -s /opt/webtorrent-desktop/WebTorrent ${DESTDIR}/usr/bin/
	vmkdir usr/share/applications
	vcopy ${FILESDIR}/webtorrent-desktop.desktop usr/share/applications/
	vlicense LICENSE
	vinstall static/WebTorrent.png 644 /usr/share/icons/hicolor/256x256/apps/ ${pkgname}.png
}
